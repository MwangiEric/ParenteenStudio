<!DOCTYPE html>
<html>
<head>
    <title>ParenTeen Kenya - YouTube Quote Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <img src="https://ik.imagekit.io/ericmwangi/cropped-Parenteen-Kenya-Logo-rec.png" 
                 class="h-20 mx-auto mb-4">
            <h1 class="text-3xl font-bold text-indigo-900 mb-2">YouTube Quote Generator</h1>
            <p class="text-gray-600">Transform YouTube videos into shareable parenting wisdom</p>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
            <!-- YouTube Analysis -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-indigo-600 mb-4">üìπ Analyze YouTube Video</h2>
                <form id="youtubeForm" class="space-y-4">
                    <input type="url" id="youtubeUrl" placeholder="YouTube URL..." 
                           class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500" required>
                    <button type="submit" 
                            class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700">
                        Extract Quotes
                    </button>
                </form>
                <div id="results" class="mt-4 hidden">
                    <div id="loading" class="text-center py-2">Loading...</div>
                    <div id="quotesList" class="space-y-2 max-h-64 overflow-y-auto mt-4"></div>
                </div>
            </div>

            <!-- Quote Creation -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-pink-600 mb-4">üé® Create Content</h2>
                <form id="contentForm" class="space-y-4">
                    <textarea id="quoteText" placeholder="Select a quote or type your own..." 
                              class="w-full p-3 border rounded-lg h-24 focus:ring-2 focus:ring-pink-500" required></textarea>
                    <button type="button" onclick="generateImage()" 
                            class="w-full bg-pink-600 text-white py-3 rounded-lg hover:bg-pink-700">
                        Generate Image
                    </button>
                </form>
                <div id="preview" class="mt-4 hidden">
                    <img id="generatedImage" class="w-full rounded-lg">
                    <a id="downloadLink" href="#" download 
                       class="block mt-2 text-center text-green-600 hover:underline">Download Image</a>
                </div>
            </div>
        </div>

        <!-- Static Quotes -->
        <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
            <h2 class="text-xl font-bold text-purple-600 mb-4">‚ú® Quick Quotes</h2>
            <div class="grid gap-3">
                {% for quote in quotes %}
                <button onclick="selectQuote('{{ quote }}')" 
                        class="text-left p-3 bg-purple-50 rounded-lg hover:bg-purple-100 transition">
                    {{ quote }}
                </button>
                {% endfor %}
            </div>
        </div>

        <footer class="text-center mt-8 text-gray-500 text-sm">
            Jane Kariuki, Teen Psychologist ‚Ä¢ parenteenkenya.co.ke
        </footer>
    </div>

    <script>
        // YouTube analysis
        document.getElementById('youtubeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const url = document.getElementById('youtubeUrl').value;
            const results = document.getElementById('results');
            const loading = document.getElementById('loading');
            const quotesList = document.getElementById('quotesList');
            
            results.classList.remove('hidden');
            loading.classList.remove('hidden');
            quotesList.innerHTML = '';
            
            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    body: `youtube_url=${encodeURIComponent(url)}`
                });
                
                const data = await response.json();
                loading.classList.add('hidden');
                
                data.quotes.forEach((quote, index) => {
                    const div = document.createElement('div');
                    div.className = 'p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100';
                    div.innerHTML = `
                        <p class="font-medium">${quote.text}</p>
                        <div class="flex justify-between items-center mt-2 text-sm text-gray-500">
                            <span>‚è∞ ${Math.floor(quote.timestamp/60)}:${Math.floor(quote.timestamp%60).toString().padStart(2,'0')}</span>
                            <a href="${quote.youtube_url}" target="_blank" class="text-blue-500">Watch ‚Üí</a>
                        </div>
                    `;
                    div.onclick = () => document.getElementById('quoteText').value = quote.text;
                    quotesList.appendChild(div);
                });
                
            } catch (error) {
                loading.classList.add('hidden');
                alert('Error: ' + error.message);
            }
        });

        // Image generation
        async function generateImage() {
            const quote = document.getElementById('quoteText').value;
            if (!quote) return alert('Please enter a quote');
            
            try {
                const response = await fetch('/generate-image', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    body: `quote=${encodeURIComponent(quote)}`
                });
                
                const imageBlob = await response.blob();
                const imageUrl = URL.createObjectURL(imageBlob);
                
                document.getElementById('preview').classList.remove('hidden');
                document.getElementById('generatedImage').src = imageUrl;
                document.getElementById('downloadLink').href = imageUrl;
                
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function selectQuote(quote) {
            document.getElementById('quoteText').value = quote;
        }
    </script>
</body>
</html>
